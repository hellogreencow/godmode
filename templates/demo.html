<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GodMode - Get to the bottom of it</title>
    <style>
        :root {
            --flowing-gradient: linear-gradient(45deg,
                #1a1a2e 0%,
                #16213e 25%,
                #0f3460 50%,
                #16213e 75%,
                #1a1a2e 100%);
            --flowing-gradient-alt: linear-gradient(135deg,
                #0f3460 0%,
                #16213e 50%,
                #1a1a2e 100%);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-muted: rgba(255, 255, 255, 0.6);
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --accent: #00d4ff;
            --success: #00ff88;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--flowing-gradient);
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
        }

        .brand-text {
            font-size: 2.5rem;
            font-weight: 300;
            text-align: center;
            margin-bottom: 3rem;
            letter-spacing: -0.02em;
            opacity: 0.9;
        }

        .input-section {
            width: 100%;
            max-width: 600px;
            text-align: center;
            z-index: 10;
        }

        .tagline {
            font-size: 1.8rem;
            font-weight: 400;
            margin-bottom: 2rem;
            opacity: 0.9;
            letter-spacing: -0.01em;
        }

        .input-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .main-input {
            width: 100%;
            padding: 1.5rem 2rem;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--card-border);
            border-radius: 50px;
            color: var(--text-primary);
            outline: none;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 400;
        }

        .main-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-input::placeholder {
            color: var(--text-muted);
            opacity: 0.8;
        }

        .submit-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .submit-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }

        .future-conversations {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 800px;
            z-index: 5;
        }

        .conversation-stack {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 60vh;
            overflow-y: auto;
            padding: 1rem 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .conversation-stack::-webkit-scrollbar {
            display: none;
        }

        .conversation-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px var(--shadow);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            transform: perspective(1000px) rotateX(5deg);
            transform-origin: center top;
        }

        .conversation-card:hover {
            transform: perspective(1000px) rotateX(0deg) translateY(-8px);
            box-shadow: 0 20px 60px var(--shadow);
            border-color: var(--accent);
        }

        .conversation-card:nth-child(1) {
            z-index: 10;
            transform: perspective(1000px) rotateX(2deg) scale(1.02);
        }

        .conversation-card:nth-child(2) {
            z-index: 9;
            transform: perspective(1000px) rotateX(4deg) scale(0.98);
            opacity: 0.9;
        }

        .conversation-card:nth-child(3) {
            z-index: 8;
            transform: perspective(1000px) rotateX(6deg) scale(0.96);
            opacity: 0.8;
        }

        .conversation-card:nth-child(n+4) {
            z-index: 7;
            transform: perspective(1000px) rotateX(8deg) scale(0.94);
            opacity: 0.7;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--card-border);
        }

        .turn-number {
            font-weight: 600;
            color: var(--accent);
            font-size: 1rem;
        }

        .confidence-score {
            background: var(--success);
            color: #000;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-section {
            margin-bottom: 1.5rem;
        }

        .question-label {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .question-text {
            color: var(--text-primary);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .response-section .question-label {
            color: var(--success);
        }

        .response-text {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .origin-questions {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 800px;
            z-index: 5;
        }

        .origin-stack {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 40vh;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .origin-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            transform: translateY(0);
        }

        .origin-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-4px) translateX(4px);
            border-color: var(--accent);
        }

        .origin-card:nth-child(1) {
            z-index: 10;
        }

        .origin-card:nth-child(2) {
            z-index: 9;
            margin-left: 2rem;
        }

        .origin-card:nth-child(3) {
            z-index: 8;
            margin-left: 4rem;
        }

        .origin-card:nth-child(n+4) {
            z-index: 7;
            margin-left: 6rem;
        }

        .origin-number {
            display: inline-block;
            background: var(--accent);
            color: #000;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .origin-text {
            color: var(--text-secondary);
            font-size: 1rem;
            flex: 1;
        }

        .reasoning-indicator {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px var(--shadow);
            max-width: 300px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            z-index: 20;
        }

        .reasoning-indicator.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .reasoning-type {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .reasoning-explanation {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            transition: width 1s ease;
            border-radius: 3px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 30;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            text-align: center;
            color: var(--text-primary);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @media (max-width: 768px) {
            .brand-text {
                font-size: 2rem;
            }

            .tagline {
                font-size: 1.5rem;
            }

            .main-input {
                font-size: 1rem;
                padding: 1.25rem 1.5rem;
            }

            .conversation-card,
            .origin-card {
                margin-left: 0 !important;
                transform: none !important;
            }

            .conversation-card:hover {
                transform: translateY(-4px) !important;
            }

            .future-conversations,
            .origin-questions {
                max-width: 95vw;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Future Conversations (Above Input) -->
        <div class="future-conversations" id="future-conversations" style="display: none;">
            <div class="conversation-stack" id="conversation-stack">
                <!-- Future conversation cards will be inserted here -->
            </div>
        </div>

        <!-- Main Input Section -->
        <div class="input-section">
            <div class="brand-text">GodMode</div>
            <div class="tagline">Get to the bottom of it</div>

            <div class="input-container">
                <input
                    type="text"
                    class="main-input"
                    id="message-input"
                    placeholder="Ask anything..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="submit-btn" onclick="sendMessage()" id="send-button">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Origin Questions (Below Input) -->
        <div class="origin-questions" id="origin-questions" style="display: none;">
            <div class="origin-stack" id="origin-stack">
                <!-- Origin question cards will be inserted here -->
            </div>
        </div>

        <!-- Reasoning Indicator -->
        <div class="reasoning-indicator" id="reasoning-indicator">
            <div class="reasoning-type" id="reasoning-type">Initializing...</div>
            <div class="reasoning-explanation" id="reasoning-explanation">Connecting to GodMode intelligence</div>
            <div class="confidence-bar">
                <div class="confidence-fill" id="confidence-fill" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div class="loading-text">Analyzing your question...</div>
                <div class="loading-subtext">Predicting conversation trajectory</div>
            </div>
        </div>
    </div>

    <script>
        let websocket = null;
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const futureConversations = document.getElementById('future-conversations');
        const conversationStack = document.getElementById('conversation-stack');
        const originQuestions = document.getElementById('origin-questions');
        const originStack = document.getElementById('origin-stack');
        const reasoningIndicator = document.getElementById('reasoning-indicator');
        const loadingOverlay = document.getElementById('loading-overlay');
        let isProcessing = false;
        const clientId = 'demo_' + Math.random().toString(36).substr(2, 9);

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws/${clientId}`;

            websocket = new WebSocket(wsUrl);

            websocket.onopen = function(event) {
                console.log('Connected to GodMode server');
                updateReasoningIndicator('Connected', 'Ready to predict conversations', 1.0);
            };

            websocket.onclose = function(event) {
                console.log('Disconnected from server');
                updateReasoningIndicator('Disconnected', 'Connection lost - predictions limited', 0.0);
                setTimeout(connectWebSocket, 3000);
            };

            websocket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };

            websocket.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateReasoningIndicator('Connection Error', 'Unable to connect to server', 0.0);
            };
        }

        function handleWebSocketMessage(data) {
            const messageType = data.type;

            switch(messageType) {
                case 'prediction_start':
                    showLoading();
                    updateReasoningIndicator('Analyzing...', 'Selecting optimal reasoning approach', 0.2);
                    break;
                case 'reasoning_selected':
                    updateReasoningIndicator(data.reasoning_type, data.explanation, data.confidence);
                    break;
                case 'future_conversation':
                    displayFutureConversation(data.conversation_turns);
                    break;
                case 'conversation_branches':
                    // Branches are now handled within the context-aware prediction
                    break;
                case 'origin_questions':
                    displayOriginQuestions(data.questions);
                    break;
                case 'prediction_complete':
                    hideLoading();
                    updateReasoningIndicator('Complete', `Prediction confidence: ${(data.confidence * 100).toFixed(1)}%`, data.confidence);
                    break;
                case 'error':
                    hideLoading();
                    updateReasoningIndicator('Error', data.message, 0.0);
                    break;
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message && !isProcessing && websocket && websocket.readyState === WebSocket.OPEN) {
                isProcessing = true;
                sendButton.disabled = true;
                sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                const payload = {
                    type: 'predict',
                    question: message,
                    context: []
                };

                websocket.send(JSON.stringify(payload));
                messageInput.value = '';
            } else if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                updateReasoningIndicator('Not Connected', 'Please refresh the page', 0.0);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function updateReasoningIndicator(type, explanation, confidence) {
            const typeEl = document.getElementById('reasoning-type');
            const expEl = document.getElementById('reasoning-explanation');
            const fillEl = document.getElementById('confidence-fill');

            typeEl.textContent = type;
            expEl.textContent = explanation;
            fillEl.style.width = `${confidence * 100}%`;

            if (confidence > 0) {
                reasoningIndicator.classList.add('visible');
            }
        }

        function showLoading() {
            loadingOverlay.classList.add('visible');
        }

        function hideLoading() {
            loadingOverlay.classList.remove('visible');
            isProcessing = false;
            sendButton.disabled = false;
            sendButton.innerHTML = '<i class="fas fa-arrow-right"></i>';
        }

        function displayFutureConversation(conversationTurns) {
            if (!conversationTurns || conversationTurns.length === 0) return;

            conversationStack.innerHTML = '';

            conversationTurns.slice(0, 10).forEach((turn, index) => {
                const card = document.createElement('div');
                card.className = 'conversation-card';
                card.onclick = () => startNewConversation(turn.user_question);

                card.innerHTML = `
                    <div class="card-header">
                        <span class="turn-number">Turn ${turn.turn_number}</span>
                        <span class="confidence-score">${Math.round(turn.confidence * 100)}%</span>
                    </div>

                    <div class="question-section">
                        <div class="question-label">You asked:</div>
                        <div class="question-text">${turn.user_question}</div>
                    </div>

                    <div class="question-section response-section">
                        <div class="question-label">GodMode responded:</div>
                        <div class="response-text">${turn.ai_response}</div>
                    </div>
                `;

                conversationStack.appendChild(card);
            });

            futureConversations.style.display = 'block';
        }

        function displayOriginQuestions(questions) {
            if (!questions || questions.length === 0) return;

            originStack.innerHTML = '';

            questions.slice(0, 10).forEach((question, index) => {
                const card = document.createElement('div');
                card.className = 'origin-card';
                card.onclick = () => startNewConversation(question);

                card.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span class="origin-number">${index + 1}</span>
                        <span class="origin-text">${question}</span>
                    </div>
                `;

                originStack.appendChild(card);
            });

            originQuestions.style.display = 'block';
        }

        function startNewConversation(question) {
            // Clear current predictions
            futureConversations.style.display = 'none';
            originQuestions.style.display = 'none';
            reasoningIndicator.classList.remove('visible');

            // Set the new question in input
            messageInput.value = question;

            // Auto-submit the question
            setTimeout(() => sendMessage(), 100);
        }

        // Initialize WebSocket connection
        connectWebSocket();

        // Add some example questions after a delay
        setTimeout(() => {
            const examples = [
                "How does quantum computing work?",
                "What are the implications of artificial general intelligence?",
                "How do black holes form?",
                "What is the future of renewable energy?",
                "How does consciousness emerge from neural activity?"
            ];

            // For now, just set up the interface
            updateReasoningIndicator('Ready', 'Enter a question to see the future of your conversation', 1.0);
        }, 2000);
    </script>
</body>
</html>
